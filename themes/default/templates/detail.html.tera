<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ link_name | escape }} Â· {{ site_title | escape }}</title>
    {% if site_desc and site_desc != "" %}
    <meta name="description" content="{{ site_desc | escape }}">
    {% endif %}
    <link rel="icon" href="../../assets/favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="../../assets/styles.css">
  </head>
  <body class="theme-{{ color_scheme }}">
    <div class="top-actions">
      <button id="toggleTheme" class="btn ghost" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ“</button>
    </div>
    <header class="hero">
      <div class="hero-inner">
        <div class="hero-center">
          <div id="clock" class="clock">--:--</div>
          <a id="clock-date" class="clock-date" href="https://www.51wnl.com/webcalandar/index.html" target="_blank" rel="noopener"></a>
        </div>
        <div class="searchbar" style="height:1px"></div>
      </div>
    </header>

    <main class="container">
      <div class="detail-layout">
        <article class="detail-main">
          <div class="card detail-header">
            <div class="card-head head-split">
              <div class="head-left">
                {% if link_icon %}
                <img class="icon" src="{{ link_icon | escape }}" alt="">
                {% endif %}
                <div class="title">{{ link_name | escape }}</div>
              </div>
              <div class="head-right header-actions">
                <a class="btn small" id="proceed" target="_self" rel="noopener noreferrer" href="{{ link_url | escape }}">ç»§ç»­å‰å¾€</a>
                <a class="btn ghost small" href="../../index.html">è¿”å›</a>
                <button class="btn ghost small" id="copyLink" data-url="{{ link_url | escape }}">å¤åˆ¶é“¾æ¥</button>
                <button class="btn ghost small" id="copyQuote" data-quote="{{ link_name | escape }} - {{ link_url | escape }}">å¤åˆ¶å¼•ç”¨</button>
                <button class="btn ghost small" id="showQR">äºŒç»´ç </button>
                {% if has_delay %}<button class="btn ghost small" id="cancelAuto" style="display:none;">å–æ¶ˆ</button>{% endif %}
              </div>
            </div>
            <div class="meta-row">
              <span class="badge risk-{{ risk_class }}">é£é™©ç­‰çº§ï¼š{{ risk_label }}</span>
              {% if link_host and link_host != "" %}
              <span class="chip">{{ link_host | escape }}</span>
              {% endif %}
            </div>
            {% if link_intro and link_intro != "" %}
            <div class="tldr">
              <strong>TL;DR</strong>
              <span class="tldr-text">{{ link_intro | escape }}</span>
            </div>
            {% endif %}
            <div class="meta" id="cdWrap" style="display:none;">å°†äº <strong id="cd">{{ delay_seconds }}</strong> ç§’åè·³è½¬â€¦â€¦</div>
            
            <!-- ç›®æ ‡ä¿¡æ¯ä¸é£é™©æç¤ºï¼ˆåˆå¹¶åŸä¾§æ å†…å®¹ï¼Œå¹³é“ºåœ¨å¤´éƒ¨å¡ç‰‡ä¸­ï¼‰ -->
            <div class="side-block">
              <div class="side-title">ç›®æ ‡ä¿¡æ¯</div>
              {% if link_host and link_host != "" %}
              <div class="meta">åŸŸåï¼š<code>{{ link_host | escape }}</code></div>
              {% endif %}
              <div class="meta">åœ°å€ï¼š<code id="targetUrl">{{ link_url | escape }}</code></div>
            </div>
            <div class="side-block">
              <div class="side-title">é£é™©æç¤º</div>
              <div class="desc">
                <ul>
                  <li>ç¡®è®¤ç›®æ ‡åŸŸåæ˜¯å¦æ­£ç¡®ï¼š<code>{{ link_host | escape }}</code></li>
                  <li>ä¼˜å…ˆè®¿é—® HTTPSï¼ˆåœ°å€æ åº”æ˜¾ç¤ºé”å½¢æ ‡è¯†ï¼‰ã€‚</li>
                  <li>è°¨æ…è¾“å…¥è´¦å·ã€å¯†ç ã€éªŒè¯ç ç­‰æ•æ„Ÿä¿¡æ¯ã€‚</li>
                  <li>å¦‚æ¥è‡ªä¸æ˜æ¥æºï¼Œè¯·å‹¿ä¸‹è½½æˆ–è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶ã€‚</li>
                </ul>
              </div>
            </div>
          </div>

          {% if link_details_html or (link_intro and link_intro != "") %}
          <section class="card detail-body-wrap">
            <div id="detailBody" class="prose">
              {% if link_details_html %}
                {{ link_details_html | safe }}
              {% else %}
                <p>{{ link_intro | escape }}</p>
              {% endif %}
            </div>
          </section>
          {% endif %}
        </article>
        
      </div>
    </main>

    <footer class="site-footer">Made with â¤ by dove Â· <a href="../../sitemap.xml">Sitemap</a> Â· <a href="../../robots.txt">Robots</a> Â· v{{ build_version | escape }}</footer>

    <div id="toast" class="toast" role="status" aria-live="polite" hidden></div>
    <div id="qrModal" class="modal" hidden>
      <div class="modal-card">
        <div class="side-title">æ‰«ç æ‰“å¼€</div>
        <div class="qr-box"><div id="qrImg" aria-label="äºŒç»´ç " role="img"></div></div>
        <div class="meta" style="margin-top:8px; word-break: break-all;"><code>{{ link_url | escape }}</code></div>
        <div class="modal-actions"><button id="closeQR" class="btn small">å…³é—­</button></div>
      </div>
    </div>

    <script src="../../assets/app.js"></script>
    <script src="../../assets/qrcode.min.js"></script>
    <script>
      (function(){
        var hasDelay = {{ has_delay | json_encode | safe }};
        var delay = {{ delay_seconds | json_encode | safe }} || 0;
        var url = {{ link_url | json_encode | safe }};
        var proceed = document.getElementById('proceed');
        var cdWrap = document.getElementById('cdWrap');
        var cd = document.getElementById('cd');
        var cancelBtn = document.getElementById('cancelAuto');
        var timer = null, remain = delay;
        function setProceedState(disabled, text){
          if(proceed){ if(disabled) proceed.setAttribute('disabled','true'); else proceed.removeAttribute('disabled'); if(text) proceed.textContent = text; }
        }
        function startCountdown(ev){
          if (!hasDelay || delay <= 0) { return; }
          ev.preventDefault();
          cdWrap && (cdWrap.style.display = 'block');
          if (cancelBtn) cancelBtn.style.display = 'inline-block';
          setProceedState(true, 'å‡†å¤‡è·³è½¬â€¦');
          remain = delay;
          if (cd) cd.textContent = String(remain);
          timer = setInterval(function(){
            remain -= 1;
            if (cd) cd.textContent = String(remain);
            if (remain <= 0) {
              clearInterval(timer); timer=null;
              window.location.href = url;
            }
          }, 1000);
        }
        if (proceed) { proceed.addEventListener('click', startCountdown); }
        function cancelCountdown(){
          if (timer) { clearInterval(timer); timer=null; }
          setProceedState(false, 'ç»§ç»­å‰å¾€');
          cdWrap && (cdWrap.style.display = 'none');
          if (cancelBtn) cancelBtn.style.display = 'none';
        }
        if (cancelBtn) { cancelBtn.addEventListener('click', cancelCountdown); }

        // å¤åˆ¶
        function showToast(msg){
          var t = document.getElementById('toast');
          if(!t) return;
          t.textContent = msg;
          t.hidden = false;
          t.classList.add('show');
          setTimeout(function(){ t.classList.remove('show'); t.hidden = true; }, 1600);
        }
        var copyLink = document.getElementById('copyLink');
        var copyQuote = document.getElementById('copyQuote');
        copyLink && copyLink.addEventListener('click', function(){
          var u = this.getAttribute('data-url');
          if(!u) return;
          navigator.clipboard && navigator.clipboard.writeText(u).then(function(){ showToast('å·²å¤åˆ¶é“¾æ¥'); });
        });
        copyQuote && copyQuote.addEventListener('click', function(){
          var q = this.getAttribute('data-quote');
          if(!q) return;
          navigator.clipboard && navigator.clipboard.writeText(q).then(function(){ showToast('å·²å¤åˆ¶å¼•ç”¨'); });
        });
        

        // QR code modal (offline generation)
        var showQR = document.getElementById('showQR');
        var qrModal = document.getElementById('qrModal');
        var closeQR = document.getElementById('closeQR');
        var qrContainer = document.getElementById('qrImg');
        var qrcodeInstance = null;
        function openQR(){
          if(!qrModal) return;
          if(qrContainer){
            // æ¸…ç©ºå®¹å™¨ä»¥é¿å…é‡å¤æ¸²æŸ“
            qrContainer.innerHTML = '';
            try {
              qrcodeInstance = new QRCode(qrContainer, {
                text: url,
                width: 220,
                height: 220,
                correctLevel: (window.QRCode && QRCode.CorrectLevel && QRCode.CorrectLevel.M) ? QRCode.CorrectLevel.M : 1
              });
            } catch (e) {
              // å›é€€ï¼šè‹¥åº“ä¸å¯ç”¨ï¼Œåˆ™ä¿æŒåŸé“¾æ¥æ–‡æœ¬
            }
          }
          qrModal.hidden = false; qrModal.classList.add('open');
        }
        function closeQRModal(){ if(!qrModal) return; qrModal.classList.remove('open'); qrModal.hidden = true; }
        showQR && showQR.addEventListener('click', openQR);
        closeQR && closeQR.addEventListener('click', closeQRModal);
        qrModal && qrModal.addEventListener('click', function(ev){ if(ev.target === qrModal){ closeQRModal(); } });
      })();
    </script>
  </body>
</html>
